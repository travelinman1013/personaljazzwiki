---
import Layout from './Layout.astro';
import Infobox from '../components/Infobox.astro';
import TableOfContents from '../components/TableOfContents.astro';

interface Props {
  title: string;
  data: Record<string, unknown>;
  description?: string;
  headings?: { id: string; text: string }[];
}

const { title, data, description, headings = [] } = Astro.props;

// Generate description from genres if not provided
const genres = (data.genres || []) as string[];
const instruments = (data.instruments || []) as string[];
const autoDescription = description || `${title} - ${genres.slice(0, 3).join(', ')} artist${instruments.length > 0 ? ` playing ${instruments.slice(0, 2).join(', ')}` : ''}`;
---

<Layout title={title} description={autoDescription}>
  <div class="wiki-layout">
    <!-- TOC Sidebar (left, desktop only) -->
    <aside class="toc-sidebar">
      <TableOfContents headings={headings} />
    </aside>

    <!-- Main Article -->
    <article class="wiki-article">
      <!-- Article Header -->
      <header class="mb-4">
        <h1 class="font-serif text-3xl font-normal border-b border-wiki-border pb-2 text-wiki-text">
          {title}
        </h1>
      </header>

      <!-- Mobile TOC (shows at top on mobile) -->
      <div class="toc-mobile-container">
        <TableOfContents headings={headings} />
      </div>

      <!-- Two-column layout with floated infobox -->
      <div class="article-body clearfix">
        <!-- Infobox (floated right) -->
        <Infobox title={title} data={data} />

        <!-- Article Content -->
        <div class="article-content prose prose-wiki max-w-none">
          <slot />
        </div>
      </div>
    </article>
  </div>
</Layout>

<style>
  /* Main layout container */
  .wiki-layout {
    display: flex;
    gap: 1.5rem;
    max-width: 100%;
  }

  /* TOC Sidebar - hidden on mobile, visible on desktop */
  .toc-sidebar {
    display: none;
    flex-shrink: 0;
    width: 180px;
  }

  /* Mobile TOC container - shown on mobile, hidden on desktop */
  .toc-mobile-container {
    display: block;
    margin-bottom: 1rem;
  }

  /* Desktop layout */
  @media (min-width: 1024px) {
    .toc-sidebar {
      display: block;
    }
    .toc-mobile-container {
      display: none;
    }
  }

  .wiki-article {
    font-family: system-ui, -apple-system, sans-serif;
    color: #202122;
    line-height: 1.65;
    flex: 1;
    min-width: 0;
  }

  .clearfix::after {
    content: "";
    display: table;
    clear: both;
  }

  /* Ensure content wraps around infobox */
  .article-body {
    overflow: hidden;
  }

  /* Content styling when next to infobox */
  .article-content {
    overflow: hidden;
  }

  /* First paragraph styling (like Wikipedia lead) */
  .article-content :global(p:first-of-type) {
    font-size: 1rem;
  }

  /* Section headings */
  .article-content :global(h2) {
    font-family: Georgia, 'Times New Roman', serif;
    font-size: 1.5rem;
    font-weight: 400;
    border-bottom: 1px solid #a2a9b1;
    padding-bottom: 0.25rem;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    clear: both;
  }

  .article-content :global(h3) {
    font-family: Georgia, 'Times New Roman', serif;
    font-size: 1.2rem;
    font-weight: 600;
    margin-top: 1.25rem;
    margin-bottom: 0.5rem;
  }

  /* Paragraph spacing */
  .article-content :global(p) {
    margin-bottom: 1rem;
    text-align: justify;
  }

  /* Lists */
  .article-content :global(ul),
  .article-content :global(ol) {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
  }

  .article-content :global(li) {
    margin-bottom: 0.25rem;
  }

  /* Links */
  .article-content :global(a) {
    color: #3366cc;
    text-decoration: none;
  }

  .article-content :global(a:hover) {
    text-decoration: underline;
  }

  /* Tables */
  .article-content :global(table) {
    border-collapse: collapse;
    margin: 1rem 0;
    width: 100%;
    font-size: 0.9rem;
  }

  .article-content :global(th),
  .article-content :global(td) {
    border: 1px solid #a2a9b1;
    padding: 0.5rem;
    text-align: left;
  }

  .article-content :global(th) {
    background-color: #eaecf0;
    font-weight: 600;
  }

  .article-content :global(tr:nth-child(even)) {
    background-color: #f8f9fa;
  }

  /* Images in content */
  .article-content :global(img) {
    max-width: 100%;
    height: auto;
    display: none; /* Hide broken images by default */
  }

  /* Blockquotes */
  .article-content :global(blockquote) {
    border-left: 4px solid #c8ccd1;
    margin: 1rem 0;
    padding: 0.5rem 1rem;
    background: #f8f9fa;
    font-style: italic;
  }

  /* Code blocks */
  .article-content :global(code) {
    background: #f8f9fa;
    padding: 0.125rem 0.25rem;
    border-radius: 2px;
    font-size: 0.9em;
  }

  .article-content :global(pre) {
    background: #f8f9fa;
    padding: 1rem;
    overflow-x: auto;
    border: 1px solid #c8ccd1;
    border-radius: 4px;
  }

  /* Horizontal rules */
  .article-content :global(hr) {
    border: none;
    border-top: 1px solid #a2a9b1;
    margin: 1.5rem 0;
  }

  /* Mobile responsiveness */
  @media (max-width: 640px) {
    .article-content :global(p) {
      text-align: left;
    }
  }
</style>
